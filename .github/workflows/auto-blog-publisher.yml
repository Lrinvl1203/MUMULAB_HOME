name: Auto Blog Publisher
# AI ìƒì‚°ì„± ë¸”ë¡œê·¸ ìë™ ë°œí–‰ ì›Œí¬í”Œë¡œìš°

on:
  schedule:
    # ë§¤ì¼ ì˜¤ì „ 9ì‹œ (KST) = UTC 0ì‹œ ì‹¤í–‰
    - cron: '0 0 * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
    inputs:
      series_index:
        description: 'Blog series index (0-29)'
        required: false
        default: '0'
  push:
    branches: [ main ]
    paths: [ '.github/workflows/auto-blog-publisher.yml' ]

env:
  BLOG_SERIES_INDEX: ${{ github.event.inputs.series_index || vars.BLOG_SERIES_INDEX || '0' }}

jobs:
  generate-and-publish:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Generate blog post
      id: generate
      run: |
        echo "ğŸš€ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ìƒì„± ì‹œì‘..."

        # í˜„ì¬ ì¸ë±ìŠ¤ í™•ì¸
        CURRENT_INDEX=${BLOG_SERIES_INDEX:-0}
        echo "í˜„ì¬ ì‹œë¦¬ì¦ˆ ì¸ë±ìŠ¤: $CURRENT_INDEX"

        # ì‹œë¦¬ì¦ˆ ì™„ë£Œ í™•ì¸
        if [ "$CURRENT_INDEX" -ge 30 ]; then
          echo "ğŸ‰ ë¸”ë¡œê·¸ ì‹œë¦¬ì¦ˆ 30ê°œ ëª¨ë‘ ì™„ì„±!"
          echo "completed=true" >> $GITHUB_OUTPUT
          exit 0
        fi

        # ë¸”ë¡œê·¸ ì£¼ì œ ë°°ì—´
        TOPICS=(
          "AIë¡œ í•˜ë£¨ 1ì‹œê°„ ì ˆì•½í•˜ê¸° - ì¼ì • ê´€ë¦¬ ìë™í™”"
          "ìŠ¤ë§ˆíŠ¸í°ìœ¼ë¡œ ì‹œì‘í•˜ëŠ” AI ìƒì‚°ì„± - í•„ìˆ˜ ì•± 5ì„ "
          "AI ìŒì„±ì¸ì‹ìœ¼ë¡œ ì—…ë¬´ íš¨ìœ¨ 10ë°° ë†’ì´ê¸°"
          "ChatGPTë¡œ ì´ë©”ì¼ ì‘ì„± ì‹œê°„ 90% ë‹¨ì¶•í•˜ê¸°"
          "AI ìš”ì•½ ë„êµ¬ë¡œ ì •ë³´ ê³¼ë¶€í•˜ í•´ê²°í•˜ê¸°"
          "ê°œì¸ ë§ì¶¤í˜• AI ë¹„ì„œ ë§Œë“¤ê¸° - GPT ì»¤ìŠ¤í…€ í™œìš©ë²•"
          "AI ë²ˆì—­ìœ¼ë¡œ ê¸€ë¡œë²Œ ì†Œí†µì˜ ë²½ í—ˆë¬¼ê¸°"
          "AIë¡œ 10ë¶„ ë§Œì— í”„ë ˆì  í…Œì´ì…˜ ì™„ì„±í•˜ê¸°"
          "AI ì´ë¯¸ì§€ ìƒì„±ìœ¼ë¡œ ì½˜í…ì¸  ì œì‘ í˜ì‹ í•˜ê¸°"
          "AI ê¸€ì“°ê¸° ë„êµ¬ë¡œ ë¸”ë¡œê·¸ í¬ìŠ¤íŒ… ìë™í™”í•˜ê¸°"
          "AI ë™ì˜ìƒ í¸ì§‘ìœ¼ë¡œ ìœ íŠœë¸Œ ì½˜í…ì¸  ì œì‘ ê°€ì†í™”"
          "AI ìŒì•… ìƒì„±ìœ¼ë¡œ ê°œì¸ ë¸Œëœë”© ì‚¬ìš´ë“œ ë§Œë“¤ê¸°"
          "AI ì½”ë”© ì–´ì‹œìŠ¤í„´íŠ¸ë¡œ í”„ë¡œê·¸ë˜ë° ìƒì‚°ì„± ê·¹ëŒ€í™”"
          "AI ë””ìì¸ ë„êµ¬ë¡œ ì „ë¬¸ê°€ê¸‰ ê·¸ë˜í”½ ë””ìì¸í•˜ê¸°"
          "AI ë°ì´í„° ë¶„ì„ìœ¼ë¡œ ê°œì¸ íŒ¨í„´ ë°œê²¬í•˜ê¸°"
          "AI ì˜ˆì¸¡ ëª¨ë¸ë¡œ ê°œì¸ ëª©í‘œ ë‹¬ì„±ë¥  ë†’ì´ê¸°"
          "AI ì¶”ì²œ ì‹œìŠ¤í…œìœ¼ë¡œ íš¨ìœ¨ì ì¸ í•™ìŠµ ê²½ë¡œ ì„¤ê³„í•˜ê¸°"
          "AI ì¬ì • ê´€ë¦¬ë¡œ ìŠ¤ë§ˆíŠ¸í•œ ê°€ê³„ë¶€ ìš´ì˜í•˜ê¸°"
          "AI ê±´ê°• ëª¨ë‹ˆí„°ë§ìœ¼ë¡œ ì›°ë¹™ ë¼ì´í”„ ì‹¤í˜„í•˜ê¸°"
          "AI íŠ¸ë Œë“œ ë¶„ì„ìœ¼ë¡œ íˆ¬ì ì¸ì‚¬ì´íŠ¸ ì–»ê¸°"
          "AI ê²½ë ¥ ë¶„ì„ìœ¼ë¡œ ì»¤ë¦¬ì–´ ë¡œë“œë§µ ê·¸ë¦¬ê¸°"
          "AI ì›Œí¬í”Œë¡œìš° ìë™í™”ë¡œ ë°˜ë³µ ì—…ë¬´ ì œë¡œ ë§Œë“¤ê¸°"
          "ê°œì¸ìš© AI ì±—ë´‡ êµ¬ì¶•ìœ¼ë¡œ 24ì‹œê°„ ì–´ì‹œìŠ¤í„´íŠ¸ ë§Œë“¤ê¸°"
          "AI í†µí•© ëŒ€ì‹œë³´ë“œë¡œ ëª¨ë“  ì •ë³´ í•œëˆˆì— ê´€ë¦¬í•˜ê¸°"
          "AI í”¼ë“œë°± ë£¨í”„ë¡œ ì§€ì†ì ì¸ ê°œì¸ ì„±ì¥ ì‹œìŠ¤í…œ ë§Œë“¤ê¸°"
          "AI í˜‘ì—… ë„êµ¬ë¡œ íŒ€ ìƒì‚°ì„± 10ë°° í–¥ìƒì‹œí‚¤ê¸°"
          "AI ë³´ì•ˆ ë„êµ¬ë¡œ ê°œì¸ì •ë³´ ë° ë””ì§€í„¸ ìì‚° ë³´í˜¸í•˜ê¸°"
          "2024ë…„ ì£¼ëª©í•´ì•¼ í•  ì‹ í¥ AI ë„êµ¬ 10ì„ "
          "AI ìœ¤ë¦¬ì™€ ê°œì¸ ìƒì‚°ì„±ì˜ ê· í˜•ì  ì°¾ê¸°"
          "AI ì‹œëŒ€ì˜ ìƒˆë¡œìš´ ìƒì‚°ì„± íŒ¨ëŸ¬ë‹¤ì„"
        )

        # í˜„ì¬ ì£¼ì œ ì„ íƒ
        if [ "$CURRENT_INDEX" -lt "${#TOPICS[@]}" ]; then
          CURRENT_TOPIC="${TOPICS[$CURRENT_INDEX]}"
        else
          echo "âŒ ì¸ë±ìŠ¤ê°€ ë²”ìœ„ë¥¼ ë²—ì–´ë‚¬ìŠµë‹ˆë‹¤: $CURRENT_INDEX"
          exit 1
        fi

        # ë‚ ì§œ ë° íŒŒì¼ëª… ìƒì„±
        DATE=$(date +%Y-%m-%d)
        FILENAME="${DATE}-$(echo "$CURRENT_TOPIC" | sed 's/[^a-zA-Z0-9ê°€-í£ ]//g' | sed 's/ /-/g').html"

        # ë¸”ë¡œê·¸ ë””ë ‰í† ë¦¬ ìƒì„±
        mkdir -p blog/posts

        # HTML í¬ìŠ¤íŠ¸ ìƒì„±
        cat > "blog/posts/$FILENAME" << EOF
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>$CURRENT_TOPIC - MUMULAB</title>
    <meta name="description" content="AI ìƒì‚°ì„± í–¥ìƒì„ ìœ„í•œ ì‹¤ìš©ì ì¸ ê°€ì´ë“œì™€ ë„êµ¬ í™œìš©ë²•">
    <meta name="keywords" content="AI, ìƒì‚°ì„±, ì¸ê³µì§€ëŠ¥, ìë™í™”, íš¨ìœ¨ì„±">
    <link rel="stylesheet" href="../../style.css">
    <style>
        .blog-post {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
            background: #fff;
            color: #333;
        }
        .post-meta {
            color: #666;
            margin-bottom: 2rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 1rem;
        }
        h1, h2, h3 { color: #2563eb; }
        h2 { border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem; margin-top: 2rem; }
        ul { margin-left: 1.5rem; margin-bottom: 1rem; }
        li { margin-bottom: 0.5rem; }
    </style>
</head>
<body>
    <div class="blog-post">
        <header>
            <h1>$CURRENT_TOPIC</h1>
            <div class="post-meta">
                <span>ğŸ“… $DATE</span>
                <span>ğŸ“‚ AI ìƒì‚°ì„±</span>
                <span>â­ ì‹œë¦¬ì¦ˆ $((CURRENT_INDEX + 1))/30</span>
            </div>
        </header>

        <main>
            <h2>ê°œìš”</h2>
            <p>í˜„ëŒ€ ì‚¬íšŒì—ì„œ AI ê¸°ìˆ ì„ í™œìš©í•œ ìƒì‚°ì„± í–¥ìƒì€ ì„ íƒì´ ì•„ë‹Œ í•„ìˆ˜ê°€ ë˜ì—ˆìŠµë‹ˆë‹¤.
            ì´ ê°€ì´ë“œì—ì„œëŠ” <strong>$CURRENT_TOPIC</strong>ì— ëŒ€í•œ ì‹¤ìš©ì ì¸ ë°©ë²•ê³¼ ë„êµ¬ë“¤ì„ ì†Œê°œí•©ë‹ˆë‹¤.</p>

            <h2>ì£¼ìš” ê¸°ëŠ¥</h2>
            <ul>
                <li><strong>íš¨ìœ¨ì„± ê·¹ëŒ€í™”</strong>: AI ë„êµ¬ë¥¼ í™œìš©í•œ ì—…ë¬´ í”„ë¡œì„¸ìŠ¤ ìµœì í™”</li>
                <li><strong>ì‹œê°„ ì ˆì•½</strong>: ë°˜ë³µì ì¸ ì‘ì—…ì˜ ìë™í™”ë¥¼ í†µí•œ ì‹œê°„ í™•ë³´</li>
                <li><strong>í’ˆì§ˆ í–¥ìƒ</strong>: AI ì–´ì‹œìŠ¤í„´íŠ¸ë¥¼ í†µí•œ ì‘ì—… í’ˆì§ˆ ê°œì„ </li>
            </ul>

            <h2>ì‹¤í–‰ ë‹¨ê³„</h2>

            <h3>1ë‹¨ê³„: í˜„ì¬ ìƒí™© ë¶„ì„</h3>
            <p>ìì‹ ì˜ í˜„ì¬ ì›Œí¬í”Œë¡œìš°ë¥¼ ë¶„ì„í•˜ê³  ê°œì„ ì´ í•„ìš”í•œ ì˜ì—­ì„ íŒŒì•…í•©ë‹ˆë‹¤.</p>

            <h3>2ë‹¨ê³„: ì ì ˆí•œ AI ë„êµ¬ ì„ íƒ</h3>
            <p>ëª©ì ì— ë§ëŠ” AI ë„êµ¬ë¥¼ ì„ íƒí•˜ê³  ê¸°ë³¸ ì„¤ì •ì„ ì™„ë£Œí•©ë‹ˆë‹¤.</p>

            <h3>3ë‹¨ê³„: ì ì§„ì  ë„ì…</h3>
            <p>ì‘ì€ ë‹¨ìœ„ë¶€í„° ì‹œì‘í•˜ì—¬ ì ì§„ì ìœ¼ë¡œ AI ë„êµ¬ ì‚¬ìš© ë²”ìœ„ë¥¼ í™•ì¥í•©ë‹ˆë‹¤.</p>

            <h3>4ë‹¨ê³„: ìµœì í™” ë° ê°œì„ </h3>
            <p>ì‚¬ìš© ê²½í—˜ì„ ë°”íƒ•ìœ¼ë¡œ ì„¤ì •ì„ ìµœì í™”í•˜ê³  ì›Œí¬í”Œë¡œìš°ë¥¼ ê°œì„ í•©ë‹ˆë‹¤.</p>

            <h2>ì‹¤ì œ í™œìš© ì‚¬ë¡€</h2>
            <p>ë§ì€ ì‚¬ìš©ìë“¤ì´ ì´ë¯¸ ì´ëŸ¬í•œ AI ë„êµ¬ë“¤ì„ í™œìš©í•˜ì—¬ ìƒì‚°ì„±ì„ í¬ê²Œ í–¥ìƒì‹œí‚¤ê³  ìˆìŠµë‹ˆë‹¤.
            ê°ìì˜ ìƒí™©ì— ë§ê²Œ ì ìš©í•´ë³´ì‹œê³ , ì§€ì†ì ìœ¼ë¡œ ê°œì„ í•´ ë‚˜ê°€ì‹œê¸° ë°”ëë‹ˆë‹¤.</p>

            <h2>ì£¼ì˜ì‚¬í•­</h2>
            <ul>
                <li>âš ï¸ AI ë„êµ¬ì— ê³¼ë„í•˜ê²Œ ì˜ì¡´í•˜ì§€ ì•Šë„ë¡ ì£¼ì˜</li>
                <li>ğŸ’¡ ê°œì¸ì •ë³´ ë³´í˜¸ì— ì‹ ê²½ ì“°ë©° ì‚¬ìš©</li>
                <li>ğŸ”§ ì •ê¸°ì ì¸ ë„êµ¬ ì—…ë°ì´íŠ¸ ë° ì„¤ì • ì ê²€</li>
            </ul>

            <h2>ë§ˆë¬´ë¦¬</h2>
            <p><strong>$CURRENT_TOPIC</strong>ë¥¼ í†µí•´ ì—¬ëŸ¬ë¶„ì˜ ì¼ìƒ ìƒì‚°ì„±ì´ í¬ê²Œ í–¥ìƒë˜ê¸°ë¥¼ ë°”ëë‹ˆë‹¤.
            ê¾¸ì¤€í•œ í•™ìŠµê³¼ ì ìš©ì„ í†µí•´ AI ì‹œëŒ€ì— ë§ëŠ” ìƒˆë¡œìš´ ì—…ë¬´ ë°©ì‹ì„ ë§Œë“¤ì–´ê°€ì„¸ìš”.</p>
        </main>

        <footer>
            <br><hr><br>
            <p>ğŸ“ <strong>MUMULAB AI ìƒì‚°ì„± ì‹œë¦¬ì¦ˆ</strong> - ë§¤ì¼ ìƒˆë¡œìš´ AI í™œìš©ë²•ì„ ì†Œê°œí•©ë‹ˆë‹¤.</p>
            <a href="../index.html">â† ë¸”ë¡œê·¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </footer>
    </div>
</body>
</html>
EOF

        echo "âœ… ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ìƒì„± ì™„ë£Œ: $FILENAME"
        echo "title=$CURRENT_TOPIC" >> $GITHUB_OUTPUT
        echo "filename=$FILENAME" >> $GITHUB_OUTPUT
        echo "next_index=$((CURRENT_INDEX + 1))" >> $GITHUB_OUTPUT
        echo "completed=false" >> $GITHUB_OUTPUT

    - name: Commit and push changes
      if: steps.generate.outputs.completed != 'true'
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action Bot"

        git add blog/posts/

        if git diff --staged --quiet; then
          echo "ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."
        else
          git commit -m "ğŸ¤– ìë™ ìƒì„±: ${{ steps.generate.outputs.title }}

          - íŒŒì¼: ${{ steps.generate.outputs.filename }}
          - ì‹œë¦¬ì¦ˆ: AI ìƒì‚°ì„± í–¥ìƒ (${{ env.BLOG_SERIES_INDEX }}/30)
          - ìë™ ìƒì„± ì‹œê°„: $(date +'%Y-%m-%d %H:%M:%S UTC')

          ğŸ¤– Generated with GitHub Actions"

          git push
        fi

    - name: Update series index
      if: steps.generate.outputs.completed != 'true'
      uses: actions/github-script@v7
      with:
        script: |
          const nextIndex = '${{ steps.generate.outputs.next_index }}';

          try {
            await github.rest.actions.createOrUpdateRepoVariable({
              owner: context.repo.owner,
              repo: context.repo.repo,
              name: 'BLOG_SERIES_INDEX',
              value: nextIndex
            });
            console.log(`ğŸ“Š ì‹œë¦¬ì¦ˆ ì¸ë±ìŠ¤ ì—…ë°ì´íŠ¸ ì„±ê³µ: ${nextIndex}`);
          } catch (error) {
            console.log(`ğŸ“Š ì‹œë¦¬ì¦ˆ ì¸ë±ìŠ¤ ì„¤ì •: ${nextIndex} (ë³€ìˆ˜ê°€ ì—†ì–´ì„œ ìƒˆë¡œ ìƒì„±)`);
          }

    - name: Success notification
      if: success() && steps.generate.outputs.completed != 'true'
      run: |
        echo "âœ… ì„±ê³µ: '${{ steps.generate.outputs.title }}' í¬ìŠ¤íŠ¸ê°€ ìë™ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!"
        echo "ğŸ“… ë‹¤ìŒ í¬ìŠ¤íŠ¸ëŠ” ë‚´ì¼ ê°™ì€ ì‹œê°„ì— ìë™ ìƒì„±ë©ë‹ˆë‹¤."
        echo "ğŸ”— íŒŒì¼: ${{ steps.generate.outputs.filename }}"

    - name: Series completion
      if: steps.generate.outputs.completed == 'true'
      run: |
        echo "ğŸ‰ AI ìƒì‚°ì„± ë¸”ë¡œê·¸ ì‹œë¦¬ì¦ˆ 30ê°œ ëª¨ë‘ ì™„ì„±!"
        echo "ğŸ“Š ì´ 30ê°œì˜ í¬ìŠ¤íŠ¸ê°€ ì„±ê³µì ìœ¼ë¡œ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤."