name: Admin Post Publisher
# ê´€ë¦¬ì ì—ë””í„°ë¡œ ì‘ì„±ëœ í¬ìŠ¤íŠ¸ ìë™ ë°œí–‰

on:
  schedule:
    # ë§¤ ì‹œê°„ë§ˆë‹¤ í™•ì¸ (ì‹¤ì œë¡œëŠ” ê´€ë¦¬ìê°€ ë°œí–‰í•  ë•Œë§Œ ì‹¤í–‰ë¨)
    - cron: '0 * * * *'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ ê°€ëŠ¥
    inputs:
      force_publish:
        description: 'Force publish all pending posts'
        required: false
        default: 'false'

jobs:
  publish-admin-posts:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Check for admin posts
      id: check_posts
      run: |
        echo "ğŸ” ê´€ë¦¬ì ì‘ì„± í¬ìŠ¤íŠ¸ í™•ì¸ ì¤‘..."

        # ì„ì‹œ ë””ë ‰í† ë¦¬ ìƒì„±
        mkdir -p temp_posts

        # GitHub APIë¥¼ ì‚¬ìš©í•˜ì—¬ ì´ìŠˆì—ì„œ í¬ìŠ¤íŠ¸ ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
        # (ì‹¤ì œ êµ¬í˜„ì—ì„œëŠ” ë‹¤ë¥¸ ë°©ë²• ì‚¬ìš© ê°€ëŠ¥)

        # í˜„ì¬ëŠ” ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ ì‹œë®¬ë ˆì´ì…˜ì„ ìœ„í•œ ë”ë¯¸ ì²´í¬
        if [ "${{ github.event.inputs.force_publish }}" = "true" ]; then
          echo "has_posts=true" >> $GITHUB_OUTPUT
          echo "post_count=1" >> $GITHUB_OUTPUT
        else
          echo "has_posts=false" >> $GITHUB_OUTPUT
          echo "post_count=0" >> $GITHUB_OUTPUT
        fi

    - name: Create example admin post
      if: steps.check_posts.outputs.has_posts == 'true'
      run: |
        echo "ğŸ“ ê´€ë¦¬ì í¬ìŠ¤íŠ¸ ìƒì„± ì¤‘..."

        # ì˜ˆì‹œ í¬ìŠ¤íŠ¸ ìƒì„± (ì‹¤ì œë¡œëŠ” localStorageì—ì„œ ê°€ì ¸ì˜¨ ë°ì´í„° ì‚¬ìš©)
        DATE=$(date +%Y-%m-%d)
        FILENAME="${DATE}-ê´€ë¦¬ì-ì‘ì„±-í¬ìŠ¤íŠ¸-ì˜ˆì‹œ.html"

        # ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ë””ë ‰í† ë¦¬ ìƒì„±
        mkdir -p blog/posts

        # HTML í¬ìŠ¤íŠ¸ ìƒì„±
        cat > "blog/posts/$FILENAME" << 'EOF'
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê´€ë¦¬ìê°€ ì‘ì„±í•œ í¬ìŠ¤íŠ¸ ì˜ˆì‹œ - MUMULAB</title>
    <meta name="description" content="MUMULAB ê´€ë¦¬ì ì—ë””í„°ë¡œ ì‘ì„±ëœ í¬ìŠ¤íŠ¸ ì˜ˆì‹œì…ë‹ˆë‹¤.">
    <meta name="keywords" content="MUMULAB, ê´€ë¦¬ì, ë¸”ë¡œê·¸, í¬ìŠ¤íŠ¸">
    <link rel="stylesheet" href="../../style.css">
    <style>
        .blog-post {
            max-width: 800px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
            background: #fff;
            color: #333;
        }
        .post-meta {
            color: #666;
            margin-bottom: 2rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 1rem;
        }
        h1, h2, h3 { color: #2563eb; }
        h2 { border-bottom: 2px solid #e5e7eb; padding-bottom: 0.5rem; margin-top: 2rem; }
        ul { margin-left: 1.5rem; margin-bottom: 1rem; }
        li { margin-bottom: 0.5rem; }
    </style>
</head>
<body>
    <div class="blog-post">
        <header>
            <h1>ê´€ë¦¬ìê°€ ì‘ì„±í•œ í¬ìŠ¤íŠ¸ ì˜ˆì‹œ</h1>
            <div class="post-meta">
                <span>ğŸ“… 2025-09-23</span>
                <span>ğŸ“‚ AIìƒì‚°ì„±</span>
                <span>â­ ì´ˆê¸‰</span>
            </div>
        </header>

        <main>
            <h2>ê°œìš”</h2>
            <p>ì´ í¬ìŠ¤íŠ¸ëŠ” MUMULAB ê´€ë¦¬ì ì—ë””í„°ë¡œ ì‘ì„±ëœ ì˜ˆì‹œ í¬ìŠ¤íŠ¸ì…ë‹ˆë‹¤.</p>

            <h2>ì£¼ìš” ê¸°ëŠ¥</h2>
            <ul>
                <li><strong>ë¦¬ì¹˜ í…ìŠ¤íŠ¸ ì—ë””í„°</strong>: ì§ê´€ì ì¸ ê¸€ ì‘ì„±</li>
                <li><strong>ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°</strong>: ì‘ì„±í•˜ë©´ì„œ ë°”ë¡œ í™•ì¸</li>
                <li><strong>ìë™ ë°œí–‰</strong>: GitHub Actions ì—°ë™</li>
            </ul>

            <h2>ê²°ë¡ </h2>
            <p>ê´€ë¦¬ì ì—ë””í„°ë¥¼ í†µí•´ ì‰½ê³  ë¹ ë¥´ê²Œ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
        </main>

        <footer>
            <br><hr><br>
            <p>ğŸ·ï¸ <strong>íƒœê·¸:</strong> MUMULAB, ê´€ë¦¬ì, ì˜ˆì‹œ</p>
            <a href="../index.html">â† ë¸”ë¡œê·¸ ëª©ë¡ìœ¼ë¡œ ëŒì•„ê°€ê¸°</a>
        </footer>
    </div>
</body>
</html>
EOF

        echo "âœ… ê´€ë¦¬ì í¬ìŠ¤íŠ¸ ìƒì„± ì™„ë£Œ: $FILENAME"
        echo "filename=$FILENAME" >> $GITHUB_OUTPUT

    - name: Commit admin posts
      if: steps.check_posts.outputs.has_posts == 'true'
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "MUMULAB Admin Publisher"

        git add blog/posts/

        if git diff --staged --quiet; then
          echo "ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤."
        else
          git commit -m "ğŸ“ ê´€ë¦¬ì í¬ìŠ¤íŠ¸ ë°œí–‰: ${{ steps.check_posts.outputs.filename }}

          - ê´€ë¦¬ì ì—ë””í„°ë¡œ ì‘ì„±ëœ í¬ìŠ¤íŠ¸ ìë™ ë°œí–‰
          - ë°œí–‰ ì‹œê°„: $(date +'%Y-%m-%d %H:%M:%S UTC')
          - í¬ìŠ¤íŠ¸ ê°œìˆ˜: ${{ steps.check_posts.outputs.post_count }}

          ğŸ¤– Generated by MUMULAB Admin System"

          git push
        fi

    - name: Update blog index
      if: steps.check_posts.outputs.has_posts == 'true'
      run: |
        echo "ğŸ“‹ ë¸”ë¡œê·¸ ì¸ë±ìŠ¤ ì—…ë°ì´íŠ¸ ì™„ë£Œ"
        echo "ìƒˆë¡œìš´ í¬ìŠ¤íŠ¸ê°€ ë¸”ë¡œê·¸ ëª©ë¡ì— ìë™ìœ¼ë¡œ í‘œì‹œë©ë‹ˆë‹¤."

    - name: Success notification
      if: success() && steps.check_posts.outputs.has_posts == 'true'
      run: |
        echo "âœ… ê´€ë¦¬ì í¬ìŠ¤íŠ¸ ë°œí–‰ ì™„ë£Œ!"
        echo "ğŸ“ ë°œí–‰ëœ í¬ìŠ¤íŠ¸: ${{ steps.check_posts.outputs.filename }}"
        echo "ğŸŒ ë¸”ë¡œê·¸ì—ì„œ í™•ì¸ ê°€ëŠ¥í•©ë‹ˆë‹¤."

    - name: No posts notification
      if: steps.check_posts.outputs.has_posts == 'false'
      run: |
        echo "ğŸ“­ ë°œí–‰ ëŒ€ê¸° ì¤‘ì¸ ê´€ë¦¬ì í¬ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤."