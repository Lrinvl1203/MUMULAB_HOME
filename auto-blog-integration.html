<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI ìƒì‚°ì„± ë¸”ë¡œê·¸ ìë™í™” ëŒ€ì‹œë³´ë“œ - MUMULAB</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .schedule-card {
            transition: transform 0.2s;
        }
        .schedule-card:hover {
            transform: translateY(-4px);
        }
        .progress-bar {
            transition: width 0.3s ease;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <div class="container mx-auto px-4 py-8">
        <!-- í—¤ë” -->
        <header class="mb-8">
            <h1 class="text-4xl font-bold text-center text-gray-800 mb-4">
                ğŸ¤– AI ìƒì‚°ì„± ë¸”ë¡œê·¸ ìë™í™” ì‹œìŠ¤í…œ
            </h1>
            <p class="text-center text-gray-600 max-w-2xl mx-auto">
                ë§¤ì¼ í•˜ë‚˜ì”© ìë™ìœ¼ë¡œ ìƒì„±ë˜ëŠ” AI ìƒì‚°ì„± í–¥ìƒ ë¸”ë¡œê·¸ í¬ìŠ¤íŠ¸ ê´€ë¦¬ ëŒ€ì‹œë³´ë“œ
            </p>
        </header>

        <!-- ìƒíƒœ ëŒ€ì‹œë³´ë“œ -->
        <div class="grid md:grid-cols-4 gap-6 mb-8">
            <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                <div class="text-3xl font-bold text-blue-600" id="totalPosts">30</div>
                <div class="text-gray-600">ì´ í¬ìŠ¤íŠ¸</div>
            </div>
            <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                <div class="text-3xl font-bold text-green-600" id="publishedPosts">0</div>
                <div class="text-gray-600">ë°œí–‰ë¨</div>
            </div>
            <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                <div class="text-3xl font-bold text-yellow-600" id="scheduledPosts">30</div>
                <div class="text-gray-600">ì˜ˆì•½ë¨</div>
            </div>
            <div class="bg-white rounded-lg shadow-lg p-6 text-center">
                <div class="text-3xl font-bold text-purple-600" id="nextPostDate">ë‚´ì¼</div>
                <div class="text-gray-600">ë‹¤ìŒ ë°œí–‰</div>
            </div>
        </div>

        <!-- ì§„í–‰ë¥  ë°” -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">ğŸ“Š ì§„í–‰ ìƒí™©</h2>
            <div class="w-full bg-gray-200 rounded-full h-4">
                <div class="progress-bar bg-blue-600 h-4 rounded-full" style="width: 0%" id="progressBar"></div>
            </div>
            <p class="text-sm text-gray-600 mt-2" id="progressText">0% ì™„ë£Œ (0/30 í¬ìŠ¤íŠ¸)</p>
        </div>

        <!-- ì»¨íŠ¸ë¡¤ íŒ¨ë„ -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">ğŸ® ì»¨íŠ¸ë¡¤ íŒ¨ë„</h2>
            <div class="grid md:grid-cols-2 lg:grid-cols-4 gap-4">
                <button onclick="startScheduler()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg transition-colors">
                    â–¶ï¸ ìŠ¤ì¼€ì¤„ëŸ¬ ì‹œì‘
                </button>
                <button onclick="pauseScheduler()" class="bg-yellow-500 hover:bg-yellow-600 text-white px-4 py-2 rounded-lg transition-colors">
                    â¸ï¸ ì¼ì‹œì •ì§€
                </button>
                <button onclick="generateNextPost()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg transition-colors">
                    ğŸ“ ë‹¤ìŒ í¬ìŠ¤íŠ¸ ìƒì„±
                </button>
                <button onclick="viewAllSchedule()" class="bg-purple-500 hover:bg-purple-600 text-white px-4 py-2 rounded-lg transition-colors">
                    ğŸ“… ì „ì²´ ì¼ì • ë³´ê¸°
                </button>
            </div>
        </div>

        <!-- ìµœê·¼ ìƒì„±ëœ í¬ìŠ¤íŠ¸ -->
        <div class="bg-white rounded-lg shadow-lg p-6 mb-8">
            <h2 class="text-xl font-semibold mb-4">ğŸ“‹ ìµœê·¼ ìƒì„±ëœ í¬ìŠ¤íŠ¸</h2>
            <div id="recentPosts" class="space-y-4">
                <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
            </div>
        </div>

        <!-- ìŠ¤ì¼€ì¤„ í…Œì´ë¸” -->
        <div class="bg-white rounded-lg shadow-lg p-6">
            <h2 class="text-xl font-semibold mb-4">ğŸ“… ë°œí–‰ ìŠ¤ì¼€ì¤„</h2>
            <div class="overflow-x-auto">
                <table class="w-full table-auto">
                    <thead>
                        <tr class="bg-gray-50">
                            <th class="px-4 py-2 text-left">#</th>
                            <th class="px-4 py-2 text-left">ë°œí–‰ì¼</th>
                            <th class="px-4 py-2 text-left">ì œëª©</th>
                            <th class="px-4 py-2 text-left">ì¹´í…Œê³ ë¦¬</th>
                            <th class="px-4 py-2 text-left">ë‚œì´ë„</th>
                            <th class="px-4 py-2 text-left">ìƒíƒœ</th>
                        </tr>
                    </thead>
                    <tbody id="scheduleTable">
                        <!-- ë™ì ìœ¼ë¡œ ìƒì„± -->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ìŠ¤ì¼€ì¤„ëŸ¬ ìŠ¤í¬ë¦½íŠ¸ -->
    <script type="module">
        // ë¸”ë¡œê·¸ ìŠ¤ì¼€ì¤„ëŸ¬ ì„í¬íŠ¸
        import AIProductivityBlogScheduler from './ai-productivity-blog-scheduler.js';

        class BlogAutomationDashboard {
            constructor() {
                this.scheduler = new AIProductivityBlogScheduler();
                this.isRunning = false;
                this.publishedCount = 0;
                this.init();
            }

            init() {
                this.updateDashboard();
                this.renderScheduleTable();
                this.loadStoredProgress();
            }

            updateDashboard() {
                const total = this.scheduler.blogSeries.length;
                const published = this.publishedCount;
                const scheduled = total - published;
                const progress = (published / total) * 100;

                document.getElementById('totalPosts').textContent = total;
                document.getElementById('publishedPosts').textContent = published;
                document.getElementById('scheduledPosts').textContent = scheduled;
                document.getElementById('progressBar').style.width = `${progress}%`;
                document.getElementById('progressText').textContent =
                    `${Math.round(progress)}% ì™„ë£Œ (${published}/${total} í¬ìŠ¤íŠ¸)`;

                // ë‹¤ìŒ ë°œí–‰ì¼ ê³„ì‚°
                const nextDate = new Date();
                nextDate.setDate(nextDate.getDate() + 1);
                document.getElementById('nextPostDate').textContent =
                    nextDate.toLocaleDateString('ko-KR', { month: 'short', day: 'numeric' });
            }

            renderScheduleTable() {
                const schedule = this.scheduler.getSchedule();
                const tableBody = document.getElementById('scheduleTable');

                tableBody.innerHTML = schedule.map((item, index) => {
                    const isPublished = index < this.publishedCount;
                    const statusClass = isPublished ? 'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-600';
                    const statusText = isPublished ? 'âœ… ë°œí–‰ë¨' : 'â³ ì˜ˆì•½ë¨';

                    return `
                        <tr class="border-b hover:bg-gray-50">
                            <td class="px-4 py-2">${item.index}</td>
                            <td class="px-4 py-2">${item.date}</td>
                            <td class="px-4 py-2 font-medium">${item.title}</td>
                            <td class="px-4 py-2">
                                <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">
                                    ${item.category}
                                </span>
                            </td>
                            <td class="px-4 py-2">
                                <span class="px-2 py-1 ${this.getDifficultyColor(item.difficulty)} rounded-full text-xs">
                                    ${item.difficulty}
                                </span>
                            </td>
                            <td class="px-4 py-2">
                                <span class="px-2 py-1 ${statusClass} rounded-full text-xs">
                                    ${statusText}
                                </span>
                            </td>
                        </tr>
                    `;
                }).join('');
            }

            getDifficultyColor(difficulty) {
                switch(difficulty) {
                    case 'ì´ˆê¸‰': return 'bg-green-100 text-green-800';
                    case 'ì¤‘ê¸‰': return 'bg-yellow-100 text-yellow-800';
                    case 'ê³ ê¸‰': return 'bg-red-100 text-red-800';
                    default: return 'bg-gray-100 text-gray-800';
                }
            }

            startScheduler() {
                if (this.isRunning) {
                    alert('ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì´ë¯¸ ì‹¤í–‰ ì¤‘ì…ë‹ˆë‹¤.');
                    return;
                }

                this.isRunning = true;
                alert('ğŸš€ ìë™ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì‹œì‘ë˜ì—ˆìŠµë‹ˆë‹¤!\në§¤ì¼ ì˜¤ì „ 9ì‹œì— ìƒˆë¡œìš´ í¬ìŠ¤íŠ¸ê°€ ìë™ ìƒì„±ë©ë‹ˆë‹¤.');

                // ì²« ì‹¤í–‰
                this.scheduleNextPost();

                // ë§¤ì¼ ì‹¤í–‰ë˜ë„ë¡ ì„¤ì •
                this.setDailySchedule();

                // ë¡œì»¬ ìŠ¤í† ë¦¬ì§€ì— ìƒíƒœ ì €ì¥
                localStorage.setItem('schedulerRunning', 'true');
            }

            pauseScheduler() {
                this.isRunning = false;
                localStorage.setItem('schedulerRunning', 'false');
                alert('â¸ï¸ ìŠ¤ì¼€ì¤„ëŸ¬ê°€ ì¼ì‹œì •ì§€ë˜ì—ˆìŠµë‹ˆë‹¤.');
            }

            scheduleNextPost() {
                const post = this.scheduler.getNextPost();
                if (post) {
                    this.createBlogPost(post);
                    this.publishedCount++;
                    this.updateDashboard();
                    this.renderScheduleTable();
                    this.saveProgress();

                    // ìµœê·¼ í¬ìŠ¤íŠ¸ í‘œì‹œ
                    this.addRecentPost(post);

                    console.log(`ğŸ“ ìƒˆ í¬ìŠ¤íŠ¸ ìƒì„±ë¨: ${post.title}`);
                } else {
                    alert('ğŸ‰ ëª¨ë“  í¬ìŠ¤íŠ¸ê°€ ìƒì„± ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                    this.isRunning = false;
                }
            }

            createBlogPost(post) {
                // ì‹¤ì œ ë¸”ë¡œê·¸ ì‹œìŠ¤í…œì— í¬ìŠ¤íŠ¸ ìƒì„±
                const filename = `${post.date}-${post.title.replace(/\s+/g, '-').replace(/[^\w-]/g, '')}.html`;
                const htmlContent = this.scheduler.generateHTMLPost(post);

                // íŒŒì¼ ë‹¤ìš´ë¡œë“œë¡œ ì‹œë®¬ë ˆì´ì…˜ (ì‹¤ì œë¡œëŠ” ì„œë²„ì— ì—…ë¡œë“œ)
                this.downloadFile(htmlContent, filename);

                // ì‹¤ì œ êµ¬í˜„ì‹œì—ëŠ” ì—¬ê¸°ì— API í˜¸ì¶œ ì½”ë“œ ì¶”ê°€
                // await fetch('/api/posts', { method: 'POST', body: JSON.stringify(post) });
            }

            downloadFile(content, filename) {
                const blob = new Blob([content], { type: 'text/html' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = filename;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            addRecentPost(post) {
                const recentPosts = document.getElementById('recentPosts');
                const postElement = document.createElement('div');
                postElement.className = 'p-4 border border-gray-200 rounded-lg';
                postElement.innerHTML = `
                    <h3 class="font-semibold text-lg mb-2">${post.title}</h3>
                    <div class="flex items-center gap-4 text-sm text-gray-600">
                        <span>ğŸ“… ${post.date}</span>
                        <span>ğŸ“‚ ${post.category}</span>
                        <span>â­ ${post.difficulty}</span>
                    </div>
                    <p class="text-gray-700 mt-2">${post.metaDescription}</p>
                `;

                recentPosts.insertBefore(postElement, recentPosts.firstChild);

                // ìµœëŒ€ 5ê°œë§Œ í‘œì‹œ
                if (recentPosts.children.length > 5) {
                    recentPosts.removeChild(recentPosts.lastChild);
                }
            }

            setDailySchedule() {
                // ë§¤ì¼ ì˜¤ì „ 9ì‹œì— ì‹¤í–‰
                const now = new Date();
                const tomorrow9AM = new Date(now.getFullYear(), now.getMonth(), now.getDate() + 1, 9, 0, 0, 0);
                const msUntilTomorrow9AM = tomorrow9AM.getTime() - now.getTime();

                setTimeout(() => {
                    if (this.isRunning) {
                        this.scheduleNextPost();
                    }

                    // 24ì‹œê°„ë§ˆë‹¤ ë°˜ë³µ
                    setInterval(() => {
                        if (this.isRunning) {
                            this.scheduleNextPost();
                        }
                    }, 86400000);
                }, msUntilTomorrow9AM);
            }

            saveProgress() {
                localStorage.setItem('publishedCount', this.publishedCount.toString());
                localStorage.setItem('currentIndex', this.scheduler.currentIndex.toString());
            }

            loadStoredProgress() {
                const stored = localStorage.getItem('publishedCount');
                if (stored) {
                    this.publishedCount = parseInt(stored);
                    this.scheduler.currentIndex = parseInt(localStorage.getItem('currentIndex') || '0');
                }

                const schedulerRunning = localStorage.getItem('schedulerRunning');
                if (schedulerRunning === 'true') {
                    this.isRunning = true;
                    this.setDailySchedule();
                }
            }
        }

        // ì „ì—­ í•¨ìˆ˜ë“¤
        window.dashboard = new BlogAutomationDashboard();

        window.startScheduler = () => dashboard.startScheduler();
        window.pauseScheduler = () => dashboard.pauseScheduler();
        window.generateNextPost = () => dashboard.scheduleNextPost();
        window.viewAllSchedule = () => {
            const schedule = dashboard.scheduler.getSchedule();
            console.table(schedule);
            alert('ğŸ“‹ ì „ì²´ ìŠ¤ì¼€ì¤„ì´ ë¸Œë¼ìš°ì € ì½˜ì†”ì— ì¶œë ¥ë˜ì—ˆìŠµë‹ˆë‹¤. (F12 â†’ Console íƒ­ í™•ì¸)');
        };

        // í˜ì´ì§€ ë¡œë“œ ì‹œ ìë™ ì´ˆê¸°í™”
        console.log('ğŸš€ AI ìƒì‚°ì„± ë¸”ë¡œê·¸ ìë™í™” ì‹œìŠ¤í…œì´ ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤!');
    </script>
</body>
</html>